# üìû –†–µ–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ NovoFon

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–º–∞–Ω–¥–∞ `originate PJSIP/79522675444@novofon extension 100@test` —Å–æ–∑–¥–∞–ª–∞ **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π** –∑–≤–æ–Ω–æ–∫ –≤–Ω—É—Ç—Ä–∏ Asterisk, –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–π –∑–≤–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ NovoFon.

## –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä—è–º–æ–π –∑–≤–æ–Ω–æ–∫ –Ω–∞ –Ω–æ–º–µ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
sudo asterisk -rvvv
```

–í –∫–æ–Ω—Å–æ–ª–∏ Asterisk:

```bash
# –ó–≤–æ–Ω–æ–∫ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —á–µ—Ä–µ–∑ NovoFon
originate PJSIP/79991234567@novofon application Playback hello-world
```

–ì–¥–µ `79991234567` - —Ä–µ–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–º–æ–∂–Ω–æ —Å–≤–æ–π –º–æ–±–∏–ª—å–Ω—ã–π –¥–ª—è —Ç–µ—Å—Ç–∞).

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Dial() –≤ dialplan

–°–æ–∑–¥–∞–π extension –¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤:

```bash
sudo nano /etc/asterisk/extensions.conf
```

–î–æ–±–∞–≤—å –≤ –∫–æ–Ω–µ—Ü:

```ini
[outgoing-test]
; –ò—Å—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ NovoFon –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä
exten => _X.,1,NoOp(=== Outgoing call to ${EXTEN} via NovoFon ===)
 same => n,Set(CALLERID(num)=+79581114585)
 same => n,Dial(PJSIP/${EXTEN}@novofon,30)
 same => n,Hangup()
```

–ó–∞—Ç–µ–º –≤ –∫–æ–Ω—Å–æ–ª–∏ Asterisk:

```bash
originate Local/79991234567@outgoing-test application Playback hello-world
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ ARI (–µ—Å–ª–∏ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω)

```bash
curl -X POST \
  -u novofon_bot:novofon_bot_2024 \
  http://localhost:8088/ari/channels \
  -H "Content-Type: application/json" \
  -d '{
    "endpoint": "PJSIP/79991234567@novofon",
    "app": "novofon_bot",
    "callerId": "+79581114585"
  }'
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–≤–æ–Ω–∫–æ–º

### 1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ endpoint –Ω–∞—Å—Ç—Ä–æ–µ–Ω:

```bash
sudo asterisk -rx "pjsip show endpoints"
```

–î–æ–ª–∂–µ–Ω –±—ã—Ç—å endpoint `novofon`.

### 2. –ü—Ä–æ–≤–µ—Ä—å SIP —Ç—Ä–∞—Ñ–∏–∫:

```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
sudo tcpdump -i any -n port 5060 -v
```

–ó–∞—Ç–µ–º —Å–¥–µ–ª–∞–π –∑–≤–æ–Ω–æ–∫ - –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å SIP –ø–∞–∫–µ—Ç—ã –∫ `sip.novofon.ru`.

### 3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Asterisk:

```bash
sudo tail -f /var/log/asterisk/full
```

---

## –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏

1. Asterisk –æ—Ç–ø—Ä–∞–≤–∏—Ç INVITE –Ω–∞ `sip.novofon.ru`
2. NovoFon –ø–æ–ª—É—á–∏—Ç –∑–∞–ø—Ä–æ—Å —Å —Ç–≤–æ–µ–≥–æ IP (109.73.192.126)
3. NovoFon –¥–æ–∑–≤–æ–Ω–∏—Ç—Å—è –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
4. –¢—ã –ø–æ–ª—É—á–∏—à—å –∑–≤–æ–Ω–æ–∫ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω
5. NovoFon –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∑–≤–æ–Ω–æ–∫ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω–∫

---

## –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: "No matching endpoint found"

–ü—Ä–æ–≤–µ—Ä—å pjsip.conf - endpoint –¥–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è `novofon`:

```bash
sudo asterisk -rx "pjsip show endpoints" | grep novofon
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–≤–æ–Ω–æ–∫ –Ω–µ —É—Ö–æ–¥–∏—Ç

1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ pjsip.conf —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SIP —Å–µ—Ä–≤–µ—Ä:
   ```
   contact = sip:sip.novofon.ru
   ```

2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:
   ```bash
   sudo tail -f /var/log/asterisk/full | grep -i novofon
   ```

3. –ü—Ä–æ–≤–µ—Ä—å firewall:
   ```bash
   sudo ufw status
   sudo ufw allow 5060/udp
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: NovoFon –Ω–µ –≤–∏–¥–∏—Ç –∑–≤–æ–Ω–æ–∫

- –£–±–µ–¥–∏—Å—å, —á—Ç–æ **–∞–¥—Ä–µ—Å–∞ —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–∏** –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ (109.73.192.126)
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∑–≤–æ–Ω–æ–∫ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É—à—ë–ª —á–µ—Ä–µ–∑ SIP (—Å–º–æ—Ç—Ä–∏ tcpdump)
- –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–≤–æ–Ω–∏—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π –Ω–æ–º–µ—Ä

