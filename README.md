# NovoFon Voice Bot ü§ñ

–ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–æ–±–æ—Ç-–æ–±–∑–≤–æ–Ω—â–∏–∫ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π NovoFon API, Asterisk ARI –∏ ElevenLabs AI.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–±–∑–≤–æ–Ω –Ω–æ–º–µ—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å NovoFon API –¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ Real-time –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–∞ —á–µ—Ä–µ–∑ Asterisk + ARI
- ‚úÖ ASR/TTS —á–µ—Ä–µ–∑ ElevenLabs (Real-time WebSocket)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞–º–∏ —á–µ—Ä–µ–∑ FSM (Finite State Machine)
- ‚úÖ –û—á–µ—Ä–µ–¥—å –æ–±–∑–≤–æ–Ω–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
- ‚úÖ –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –≤ PostgreSQL

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
NovoFon API ‚Üí Asterisk (SIP) ‚Üí ARI ‚Üí FastAPI Backend
                                           ‚Üì
                                    ElevenLabs ASR/TTS
                                           ‚Üì
                                      PostgreSQL
```

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.11+
- PostgreSQL 14+
- Redis 7+
- Asterisk 20+ (—Å ARI –º–æ–¥—É–ª–µ–º)

### API –∫–ª—é—á–∏
- NovoFon API –∫–ª—é—á
- ElevenLabs API –∫–ª—é—á

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (Windows)
venv\Scripts\activate

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å (Linux/Mac)
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—à–∏ –∫–ª—é—á–∏
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL
createdb novofon_bot

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# Development —Ä–µ–∂–∏–º
python app/main.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ uvicorn
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger: http://localhost:8000/docs

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
NovoFon_Bot/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ models.py            # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ routers/             # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã)
‚îÇ   ‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ novofon.py       # NovoFon API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ asterisk.py      # Asterisk ARI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ elevenlabs.py    # ElevenLabs ASR/TTS
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dialogue.py      # FSM –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã (–±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã)
‚îú‚îÄ‚îÄ alembic/                 # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ logs/                    # –õ–æ–≥–∏
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md
```

## üîß –≠—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- [x] **–≠—Ç–∞–ø 1**: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ + FastAPI + –ë–î –º–æ–¥–µ–ª–∏ ‚úÖ
- [x] **–≠—Ç–∞–ø 2**: NovoFon API –∫–ª–∏–µ–Ω—Ç ‚úÖ
- [x] **–≠—Ç–∞–ø 3**: Asterisk + ARI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚úÖ
- [x] **–≠—Ç–∞–ø 4**: ElevenLabs Real-time ASR/TTS ‚úÖ
- [x] **–≠—Ç–∞–ø 5**: FSM –ª–æ–≥–∏–∫–∞ –¥–∏–∞–ª–æ–≥–∞ ‚úÖ
- [x] **–≠—Ç–∞–ø 6**: –û—á–µ—Ä–µ–¥—å –æ–±–∑–≤–æ–Ω–∞ ‚úÖ

**üéâ –í–°–ï –≠–¢–ê–ü–´ –ó–ê–í–ï–†–®–ï–ù–´!**

## üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### Call (–ó–≤–æ–Ω–∫–∏)
- `id` - UUID –∑–≤–æ–Ω–∫–∞
- `phone` - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `status` - –°—Ç–∞—Ç—É—Å (pending, in_progress, completed, etc.)
- `start_time`, `end_time`, `duration`
- `scenario_result` - –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è

### Message (–°–æ–æ–±—â–µ–Ω–∏—è –≤ –¥–∏–∞–ª–æ–≥–µ)
- `id` - UUID —Å–æ–æ–±—â–µ–Ω–∏—è
- `call_id` - –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–≤–æ–Ω–æ–∫
- `role` - –†–æ–ª—å (user/bot/system)
- `text` - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `timestamp` - –í—Ä–µ–º—è

### CallQueue (–û—á–µ—Ä–µ–¥—å –æ–±–∑–≤–æ–Ω–∞)
- `id` - UUID –∑–∞–¥–∞—á–∏
- `phone` - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `priority` - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- `status` - –°—Ç–∞—Ç—É—Å (pending, in_progress, done, error)
- `retry_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫

## üîê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Asterisk

### –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/ASTERISK_SETUP.md`

**–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:**

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Asterisk (—Å–º. `docs/ASTERISK_SETUP.md`)
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∏–∑ `asterisk_configs/` –≤ `/etc/asterisk/`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SIP –¥–∞–Ω–Ω—ã–µ –æ—Ç NovoFon –≤ `pjsip.conf`
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Asterisk
5. –û–±–Ω–æ–≤–∏—Ç–µ `.env` —Å ARI –¥–∞–Ω–Ω—ã–º–∏

–ì–æ—Ç–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ `asterisk_configs/`.

## üìù API Endpoints

### System
```
GET /health                  - –û–±—â–∏–π health check
GET /health/database         - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
GET /health/novofon          - –ü—Ä–æ–≤–µ—Ä–∫–∞ NovoFon API
```

### Calls ‚úÖ
```
POST   /api/calls/initiate            - –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –∑–≤–æ–Ω–æ–∫
GET    /api/calls/{call_id}           - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–≤–æ–Ω–∫–µ
GET    /api/calls/{call_id}/messages  - –ü–æ–ª—É—á–∏—Ç—å –¥–∏–∞–ª–æ–≥ –∑–≤–æ–Ω–∫–∞
GET    /api/calls                     - –°–ø–∏—Å–æ–∫ –∑–≤–æ–Ω–∫–æ–≤ (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
POST   /api/calls/{call_id}/hangup    - –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫
DELETE /api/calls/{call_id}           - –£–¥–∞–ª–∏—Ç—å –∑–≤–æ–Ω–æ–∫
```

### Queue ‚úÖ
```
POST   /api/queue/add               - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä –≤ –æ—á–µ—Ä–µ–¥—å
POST   /api/queue/bulk-add          - –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
GET    /api/queue                   - –°–ø–∏—Å–æ–∫ –æ—á–µ—Ä–µ–¥–∏ (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
GET    /api/queue/{item_id}         - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–¥–∞—á–µ
POST   /api/queue/{item_id}/cancel  - –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É
DELETE /api/queue/{item_id}         - –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É
GET    /api/queue/stats/summary     - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏
POST   /api/queue/control/start     - –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
POST   /api/queue/control/stop      - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
```

üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** —Å–º. `docs/NOVOFON_API_TESTING.md`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
pytest

# –° coverage
pytest --cov=app tests/
```

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

Private project

## üë§ –ê–≤—Ç–æ—Ä

NovoFon Bot Team

---

**–°—Ç–∞—Ç—É—Å**: üéâ **–ì–û–¢–û–í–û!** –í—Å–µ 6 —ç—Ç–∞–ø–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω—ã! –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É!

